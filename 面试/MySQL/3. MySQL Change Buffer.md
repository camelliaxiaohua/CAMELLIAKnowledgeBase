---
title: MySQL Change Buffer
category: MySQL
tags:
  - MySQL原理
published: 2025-09-10
updated: 2025-09-10
link:
  - https://www.mianshiya.com/bank/1791003439968264194/question/1780933295555506178#heading-0
  - https://www.bilibili.com/video/BV17D4y1e78A/?spm_id_from=333.337.search-card.all.click&vd_source=eb6b0da4381c8ab6313ba53ec00c3e42
  - obsidian://open?vault=CAMELLIAKnowledgeBase&file=%E9%9D%A2%E8%AF%95%2FMySQL%2F2.%20%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95%20%26%20%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95
---
---

### 1. Change Buffer 是什么？

在 MySQL 的 **InnoDB 引擎**里，**Change Buffer（变更缓冲区）是一个非常聪明的机制，用来提高磁盘 I/O 效率**，尤其是对于二级索引（非聚簇索引）的更新操作。

通俗理解，想象一下，你家有一大堆账本，每次修改账本里的条目都得跑到柜子里翻找，写一条就写一条，非常慢。

- 如果修改很多条目，每次都去柜子里写，效率极低。
    

Change Buffer 就像是 **一个临时笔记本**，当你要修改二级索引时，它先把修改记录记在笔记本上（缓冲区里），而不是立即去硬盘上改真正的索引页。

- 这样可以 **先在内存里累积多条修改**，等到合适的时机（比如索引页被读取到内存，或者后台合并时）再一次性写入硬盘。
    

#### 优势：

1. **减少磁盘随机写**：大量小修改可以合并成一次连续写入，磁盘效率大大提升。
    
2. **提升更新性能**：尤其是对二级索引的 `INSERT`、`UPDATE`、`DELETE`，减少了每次操作都访问磁盘的开销。
    

#### 注意点：

- Change Buffer 只对 **二级索引** 起作用，对 **聚簇索引（主键索引）** 无效，因为主键索引必须立即更新。
    
- 如果缓存过大或合并不及时，也可能增加后台 I/O 压力。
    
- 可以通过参数 `innodb_change_buffering` 控制 Change Buffer 的使用策略（如仅插入、更新、删除都缓冲，或者只缓冲插入等）。
    

---

💡 总结一句话：  
**Change Buffer 就是 InnoDB 给[[二级索引]]做的“内存笔记本”，先记下来再慢慢写磁盘，减少随机 I/O，提高性能。**

---

如果你愿意，我可以画一个小图，把 **Change Buffer 工作流程**可视化，让你一眼就懂它的作用。

你想让我画吗？